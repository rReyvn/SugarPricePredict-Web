{% extends "base.html" %}
{% block title %}
    Dashboard
{% endblock title %}
{% block content %}
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">Dashboard</h1>
            <a href="{% url 'logout' %}"
               title="Logout"
               class="flex items-center justify-center rounded-full bg-gray-100 p-2 text-gray-800 hover:bg-gray-200">
                <svg width="20px"
                     height="20px"
                     stroke-width="2"
                     viewBox="0 0 24 24"
                     fill="none"
                     xmlns="http://www.w3.org/2000/svg"
                     color="currentColor">
                    <path d="M15 12H3m0 0l3.5-3.5M3 12l3.5 3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    </path>
                    <path d="M10 6V5a1 1 0 011-1h9a1 1 0 011 1v14a1 1 0 01-1 1h-9a1 1 0 01-1-1v-1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    </path>
                </svg>
            </a>
        </div>
        <div class="p-6 bg-white rounded-2xl shadow-md">
            <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                <h2 class="text-xl font-semibold">Dataset</h2>
                <form action="{% url 'dashboard' %}"
                      method="post"
                      enctype="multipart/form-data"
                      class="w-full sm:w-auto">
                    {% csrf_token %}
                    <div class="flex items-center gap-4">
                        <button type="button"
                                title="Retrain model"
                                class="ml-2 flex items-center justify-center rounded-full bg-gray-100 p-2 text-gray-800 hover:bg-gray-200">
                            <svg width="20px"
                                 height="20px"
                                 stroke-width="1.5"
                                 viewBox="0 0 24 24"
                                 fill="none"
                                 xmlns="http://www.w3.org/2000/svg"
                                 color="currentColor">
                                <path d="M21.1679 8C19.6247 4.46819 16.1006 2 11.9999 2C6.81459 2 2.55104 5.94668 2.04932 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path d="M17 8H21.4C21.7314 8 22 7.73137 22 7.4V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path d="M2.88146 16C4.42458 19.5318 7.94874 22 12.0494 22C17.2347 22 21.4983 18.0533 22 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path d="M7.04932 16H2.64932C2.31795 16 2.04932 16.2686 2.04932 16.6V21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                            </svg>
                        </button>
                        <input type="file"
                               name="excel_file"
                               accept=".xls,.xlsx"
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <button type="submit"
                                title="Upload file"
                                class="ml-4 inline-flex items-center justify-center rounded-full bg-indigo-600 p-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring focus:ring-indigo-500 active:bg-indigo-800">
                            <svg width="20px"
                                 height="20px"
                                 stroke-width="2"
                                 viewBox="0 0 24 24"
                                 fill="none"
                                 xmlns="http://www.w3.org/2000/svg"
                                 color="currentColor">
                                <path d="M12 6v12m6-6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
            <div>
                <div class="rounded-lg overflow-x-auto overflow-hidden border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Dataset Name
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Start Date
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    End Date
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Upload Date
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for file in uploaded_files %}
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ file.name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ file.start_date|date:"d-m-y" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ file.end_date|date:"d-m-y" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ file.upload_date|date:"d-m-y" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center justify-center space-x-4">
                                            <a href="{% url 'download_file' filename=file.name %}"
                                               title="Download file"
                                               class="flex items-center justify-center rounded-full p-2 text-indigo-600 hover:bg-indigo-100">
                                                <svg width="20px"
                                                     height="20px"
                                                     stroke-width="1.5"
                                                     viewBox="0 0 24 24"
                                                     fill="none"
                                                     xmlns="http://www.w3.org/2000/svg"
                                                     color="currentColor">
                                                    <path d="M12 13V22M12 22L15.5 18.5M12 22L8.5 18.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                    </path>
                                                    <path d="M20 17.6073C21.4937 17.0221 23 15.6889 23 13C23 9 19.6667 8 18 8C18 6 18 2 12 2C6 2 6 6 6 8C4.33333 8 1 9 1 13C1 15.6889 2.50628 17.0221 4 17.6073" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                    </path>
                                                </svg>
                                            </a>
                                            <a href="{% url 'delete_file' filename=file.name %}"
                                               title="Delete file"
                                               class="flex items-center justify-center rounded-full p-2 text-red-600 hover:bg-red-100">
                                                <svg width="20px"
                                                     height="20px"
                                                     viewBox="0 0 24 24"
                                                     stroke-width="1.5"
                                                     fill="none"
                                                     xmlns="http://www.w3.org/2000/svg"
                                                     color="currentColor">
                                                    <path d="M20 9L18.005 20.3463C17.8369 21.3026 17.0062 22 16.0353 22H7.96474C6.99379 22 6.1631 21.3026 5.99496 20.3463L4 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                    </path>
                                                    <path d="M21 6L15.375 6M3 6L8.625 6M8.625 6V4C8.625 2.89543 9.52043 2 10.625 2H13.375C14.4796 2 15.375 2.89543 15.375 4V6M8.625 6L15.375 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                    </path>
                                                </svg>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="5"
                                        class="px-6 py-4 whitespace-nowrap text-center text-gray-500">
                                        No datasets uploaded yet.
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="flex items-center justify-between px-4 py-3 sm:px-6">
                        <div class="flex flex-1 justify-between sm:hidden">
                            {% if uploaded_files.has_previous %}
                                <a href="?page={{ uploaded_files.previous_page_number }}"
                                   class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
                            {% endif %}
                            {% if uploaded_files.has_next %}
                                <a href="?page={{ uploaded_files.next_page_number }}"
                                   class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
                            {% endif %}
                        </div>
                        <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-700">
                                    Showing
                                    <span class="font-medium">{{ uploaded_files.start_index }}</span>
                                    to
                                    <span class="font-medium">{{ uploaded_files.end_index }}</span>
                                    of
                                    <span class="font-medium">{{ uploaded_files.paginator.count }}</span>
                                    results
                                </p>
                            </div>
                            <div>
                                <div>
                                    <nav class="isolate inline-flex" aria-label="Pagination">
                                        <div class="flex space-x-2">
                                            {% if uploaded_files.has_previous %}
                                                <a href="?page={{ uploaded_files.previous_page_number }}"
                                                   class="relative inline-flex items-center rounded-full px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                                                    <span class="sr-only">Previous</span>
                                                    <svg class="h-5 w-5"
                                                         viewBox="0 0 20 20"
                                                         fill="currentColor"
                                                         aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                                                    </svg>
                                                </a>
                                            {% endif %}
                                            {% for i in uploaded_files.paginator.page_range %}
                                                {% if uploaded_files.number == i %}
                                                    <a href="#"
                                                       aria-current="page"
                                                       class="relative z-10 inline-flex items-center bg-indigo-600 rounded-full px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">{{ i }}</a>
                                                {% elif i > uploaded_files.number|add:'-2' and i < uploaded_files.number|add:'2' %}
                                                    <a href="?page={{ i }}"
                                                       class="relative inline-flex items-center rounded-full px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">{{ i }}</a>
                                                {% elif i == 1 or i == uploaded_files.paginator.num_pages %}
                                                    <a href="?page={{ i }}"
                                                       class="relative inline-flex items-center rounded-full px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">{{ i }}</a>
                                                {% elif i == uploaded_files.number|add:'-3' or i == uploaded_files.number|add:'3' %}
                                                    <span class="relative inline-flex items-center rounded-full px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300 focus:outline-offset-0">...</span>
                                                {% endif %}
                                            {% endfor %}
                                            {% if uploaded_files.has_next %}
                                                <a href="?page={{ uploaded_files.next_page_number }}"
                                                   class="relative inline-flex items-center rounded-full px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                                                    <span class="sr-only">Next</span>
                                                    <svg class="h-5 w-5"
                                                         viewBox="0 0 20 20"
                                                         fill="currentColor"
                                                         aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                                                    </svg>
                                                </a>
                                            {% endif %}
                                        </div>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
